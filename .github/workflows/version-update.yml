name: Version Update

on:
  push:
    branches:
      - dev

jobs:
  createPullRequest:
    name: Create QA pull request
    runs-on: ubuntu-latest
    permissions: 
      pull-requests: write
      contents: write
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Setup Node.js 20
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: apply verison
        id: apply-version
        run: |
          yarn version apply
          rm -rf .yarn/versions
          echo "PACKAGE_VERSION=$(cat package.json | jq -r '.version')" >>  "$GITHUB_OUTPUT"

      - uses: actions/github-script@v7
        env:
          VERSION: ${{ steps.apply-version.outputs.PACKAGE_VERSION }}
        with:
          script: |
            const vupdateAndroidVersion = require('./.github/scripts/updateVersion.js')
            await vupdateAndroidVersion()

      - name: Create Pull Request
        uses: actions/github-script@v7
        env:
          VERSION: ${{ steps.apply-version.outputs.PACKAGE_VERSION }}
        with:
          script: |
            const createPullRequest = require('./.github/scripts/createPullRequest.js')
            await createPullRequest({github, context, core, exec})
