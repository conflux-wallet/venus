import React, { useMemo } from 'react';
import { StyleSheet, Platform } from 'react-native';
import { SvgUri } from 'react-native-svg';
import { Image, type ImageProps } from 'expo-image';

const defaultIcon =
  'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDkiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OSA0OCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwXzIzNzA3XzIxMjM3KSI+CjxwYXRoIGQ9Ik00Mi4xNjQ3IDE1LjM1NUM0Ni45NjA2IDIxLjk4NDYgNDMuOTM1OSAzMi4wNDMgMzUuNDg1NSAzOC4xNTU5QzI3LjA1OCA0NC4yNTIyIDE2LjgyNTEgNDMuNzA2NiAxMi4wMTYyIDM3LjA1OUM3LjE4MjMgMzAuMzc2OCA5LjUyNzc0IDE5LjY3NzYgMTcuOTEzMyAxMy42MTE3QzI2LjI5OTIgNy41NDU1IDM3LjMzMDkgOC42NzMwMSA0Mi4xNjQ3IDE1LjM1NVoiIHN0cm9rZT0idXJsKCNwYWludDBfbGluZWFyXzIzNzA3XzIxMjM3KSIgc3Ryb2tlLXdpZHRoPSIxLjUxNzQxIi8+CjxwYXRoIGQ9Ik00MC43NTcyIDExLjkxMjdDNDcuNzU0NiAyMC4yMDQ4IDQ1Ljk0NzIgMzAuMjMxMiAzNi4yMTMyIDM4LjEzMDlDMjYuMTkwNiA0NS41MjEgMTUuMzE4NSA0My43MzgyIDkuNjAzODkgMzYuNDY5N0MzLjg4OTMxIDI5LjIwMTIgNS45ODUyMSAxNy4xMTkgMTQuODYgMTAuNjk5MUMyMy43MzQ3IDQuMjc5MzEgMzUuNDkyNSA0LjYzNDkgNDAuNzU3MiAxMS45MTI3WiIgZmlsbD0idXJsKCNwYWludDFfbGluZWFyXzIzNzA3XzIxMjM3KSIvPgo8cGF0aCBkPSJNMzkuNzM0NSAxMS43MjJDNDIuMTM4NSAxNS4wNDUxIDQyLjUzNjMgMTkuMjI2IDQxLjIzNjkgMjMuMzk5NUMzOS45MzU4IDI3LjU3ODcgMzYuOTM3NiAzMS43MTQ1IDMyLjYyMTQgMzQuODM2OEMyMy45NDA0IDQxLjExNjUgMTMuNTI2NCA0MC42ODE1IDguNzI3MTYgMzQuMDQ3M0MzLjkwMzQxIDI3LjM3OTEgNi40MTM2MiAxNi41Mzk0IDE1LjA1MjUgMTAuMjkwMkMyMy42OTE3IDQuMDQwNzUgMzQuOTEwOSA1LjA1NDA3IDM5LjczNDUgMTEuNzIyWiIgc3Ryb2tlPSJ1cmwoI3BhaW50Ml9saW5lYXJfMjM3MDdfMjEyMzcpIiBzdHJva2Utd2lkdGg9IjEuNTE3NDEiLz4KPHBhdGggZD0iTTM3Ljc5NTYgMTEuNzMwM0M0MS43NzE0IDE3LjIyNjIgMzkuNTM4NyAyNi42ODU4IDMxLjIxNTggMzIuNzA2NUMyMi44OTI4IDM4LjcyNzEgMTMuMjA5NiAzNy44ODc0IDkuMjMzNzYgMzIuMzkxNEM1LjI1Nzk2IDI2Ljg5NTQgNy40OTA2NyAxNy40MzU5IDE1LjgxMzYgMTEuNDE1MkMyNC4xMzY1IDUuMzk0NTMgMzMuODE5OCA2LjIzNDI5IDM3Ljc5NTYgMTEuNzMwM1oiIGZpbGw9IiM5MEFFRkYiIHN0cm9rZT0idXJsKCNwYWludDNfbGluZWFyXzIzNzA3XzIxMjM3KSIgc3Ryb2tlLXdpZHRoPSI0LjIxNTAxIi8+CjxwYXRoIGQ9Ik0zNS43NTc0IDEzLjIwOTlDMzcuNDY4OSAxNS41NzU4IDM3LjY5NDEgMTguNzE1IDM2LjYxOSAyMS45MTAzQzM1LjU0NCAyNS4xMDQ4IDMzLjE3NTUgMjguMzI2MSAyOS43NTU3IDMwLjc5OTlDMjYuMzM1OCAzMy4yNzM3IDIyLjUzNTEgMzQuNTE1MiAxOS4xNjQ2IDM0LjUzNjRDMTUuNzkzMyAzNC41NTc3IDEyLjg4MjIgMzMuMzYxNCAxMS4xNzA3IDMwLjk5NTVDOS40NTkxNiAyOC42Mjk2IDkuMjMzOTQgMjUuNDkwMyAxMC4zMDkxIDIyLjI5NTFDMTEuMzg0IDE5LjEwMDUgMTMuNzUyNiAxNS44NzkzIDE3LjE3MjQgMTMuNDA1NEMyMC41OTIzIDEwLjkzMTYgMjQuMzkzIDkuNjkwMSAyNy43NjM1IDkuNjY4ODdDMzEuMTM0OCA5LjY0NzY0IDM0LjA0NTkgMTAuODQzOSAzNS43NTc0IDEzLjIwOTlaIiBzdHJva2U9InVybCgjcGFpbnQ0X2xpbmVhcl8yMzcwN18yMTIzNykiIHN0cm9rZS13aWR0aD0iMC42NzQ0MDIiLz4KPC9nPgo8ZGVmcz4KPGxpbmVhckdyYWRpZW50IGlkPSJwYWludDBfbGluZWFyXzIzNzA3XzIxMjM3IiB4MT0iNDEuODAyNyIgeTE9IjEzLjU0MjIiIHgyPSIxNS44ODIzIiB5Mj0iNDIuNjgxMyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPgo8c3RvcCBzdG9wLWNvbG9yPSIjQzFEMkZGIi8+CjxzdG9wIG9mZnNldD0iMC4xNzA2NzYiIHN0b3AtY29sb3I9IiNCM0M3RkYiLz4KPHN0b3Agb2Zmc2V0PSIwLjMwOTA4NiIgc3RvcC1jb2xvcj0iIzcwOTRGNiIvPgo8c3RvcCBvZmZzZXQ9IjAuNDkxMzE0IiBzdG9wLWNvbG9yPSIjNDU3MkVDIi8+CjxzdG9wIG9mZnNldD0iMC43MDQwMjEiIHN0b3AtY29sb3I9IiM3MDk0RjYiLz4KPHN0b3Agb2Zmc2V0PSIwLjg0MzM5OSIgc3RvcC1jb2xvcj0iI0IzQzdGRiIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNBNkJFRkYiLz4KPC9saW5lYXJHcmFkaWVudD4KPGxpbmVhckdyYWRpZW50IGlkPSJwYWludDFfbGluZWFyXzIzNzA3XzIxMjM3IiB4MT0iNDEuMzU3NiIgeTE9IjEzLjczMjkiIHgyPSIxMi43MDIxIiB5Mj0iNDIuNjcwNCIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPgo8c3RvcCBzdG9wLWNvbG9yPSIjOThCNEZGIi8+CjxzdG9wIG9mZnNldD0iMC4wNTUwNTc1IiBzdG9wLWNvbG9yPSIjOThCNEZGIi8+CjxzdG9wIG9mZnNldD0iMC4xNzA2NzYiIHN0b3AtY29sb3I9IiM0NTcyRUMiLz4KPHN0b3Agb2Zmc2V0PSIwLjQ5MTMxNCIgc3RvcC1jb2xvcj0iIzBENDFDRSIvPgo8c3RvcCBvZmZzZXQ9IjAuODgxOTQ1IiBzdG9wLWNvbG9yPSIjNDU3MkVDIi8+CjxzdG9wIG9mZnNldD0iMC45MzAyMDIiIHN0b3AtY29sb3I9IiM5OEI0RkYiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjOThCNEZGIi8+CjwvbGluZWFyR3JhZGllbnQ+CjxsaW5lYXJHcmFkaWVudCBpZD0icGFpbnQyX2xpbmVhcl8yMzcwN18yMTIzNyIgeDE9IjM5LjM3MjciIHkxPSI5LjkwOTAyIiB4Mj0iMTIuOTQ5MSIgeTI9IjM5Ljk2MTIiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0iI0MxRDJGRiIvPgo8c3RvcCBvZmZzZXQ9IjAuMTcwNjc2IiBzdG9wLWNvbG9yPSIjQjNDN0ZGIi8+CjxzdG9wIG9mZnNldD0iMC4zMDkwODYiIHN0b3AtY29sb3I9IiM3MDk0RjYiLz4KPHN0b3Agb2Zmc2V0PSIwLjQ5MTMxNCIgc3RvcC1jb2xvcj0iIzQ1NzJFQyIvPgo8c3RvcCBvZmZzZXQ9IjAuNzA0MDIxIiBzdG9wLWNvbG9yPSIjNzA5NEY2Ii8+CjxzdG9wIG9mZnNldD0iMC44NDMzOTkiIHN0b3AtY29sb3I9IiNCM0M3RkYiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjQTZCRUZGIi8+CjwvbGluZWFyR3JhZGllbnQ+CjxsaW5lYXJHcmFkaWVudCBpZD0icGFpbnQzX2xpbmVhcl8yMzcwN18yMTIzNyIgeDE9IjMwLjk1ODYiIHkxPSI0LjkwMjMiIHgyPSIxOC4xMDY1IiB5Mj0iMzkuMjY1MiIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPgo8c3RvcCBzdG9wLWNvbG9yPSIjNDU3MkVDIi8+CjxzdG9wIG9mZnNldD0iMC40MTcxMTkiIHN0b3AtY29sb3I9IiM5MEFDRkEiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjQ0NEQUZGIi8+CjwvbGluZWFyR3JhZGllbnQ+CjxsaW5lYXJHcmFkaWVudCBpZD0icGFpbnQ0X2xpbmVhcl8yMzcwN18yMTIzNyIgeDE9IjE3LjE0NDUiIHkxPSIxMi40NDA1IiB4Mj0iMzAuOTgwNSIgeTI9IjMwLjc2NzUiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzIwNTZFQiIvPgo8c3RvcCBvZmZzZXQ9IjAuNDc0OTcxIiBzdG9wLWNvbG9yPSIjNkY5NEY5IiBzdG9wLW9wYWNpdHk9IjAiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjOUJCNkZGIi8+CjwvbGluZWFyR3JhZGllbnQ+CjxjbGlwUGF0aCBpZD0iY2xpcDBfMjM3MDdfMjEyMzciPgo8cmVjdCB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIGZpbGw9IndoaXRlIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLjU1ODU5NCkiLz4KPC9jbGlwUGF0aD4KPC9kZWZzPgo8L3N2Zz4K';

const TokenIcon: React.FC<ImageProps> = ({ style, ...props }) => {
  const needRenderSVG = useMemo(() => Platform.OS === 'ios' && typeof props.source === 'string' && props.source.endsWith('svg'), [props.source]);

  if (needRenderSVG) {
    return <SvgUri style={[styles.container, typeof style === 'object' && style]} uri={props.source as string} width={40} height={40} />;
  }

  return (
    <Image
      style={[styles.container, typeof style === 'object' && style]}
      placeholder={defaultIcon}
      placeholderContentFit="contain"
      contentFit="contain"
      {...props}
    />
  );
};

const styles = StyleSheet.create({
  container: {
    borderRadius: 100,
  },
});

export default TokenIcon;
